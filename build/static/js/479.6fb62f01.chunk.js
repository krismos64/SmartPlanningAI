"use strict";(self.webpackChunksmartplanning_ai=self.webpackChunksmartplanning_ai||[]).push([[479],{2479:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(5043),s=o(4583),n=o(4634);const a=()=>{const[e,r]=(0,t.useState)([]),[o,a]=(0,t.useState)(!0),[c,l]=(0,t.useState)(null),u=(0,n.A)(),i=(0,t.useRef)(!0),p=(0,t.useRef)(!1);(0,t.useEffect)((()=>(i.current=!0,p.current=!1,()=>{i.current=!1,p.current=!1})),[]);const d=(0,t.useCallback)((async()=>{if(!p.current&&i.current){p.current=!0,a(!0);try{const e=s.H$||"http://localhost:5004";console.log(`[fetchEmployees] Utilisation de l'URL: ${e}`);const o=localStorage.getItem("token");if(!o)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const t=await fetch(`${e}/api/employees`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors du chargement des employ\xe9s")}const n=await t.json();return i.current&&(r(Array.isArray(n)?n:[]),l(null)),n}catch(c){throw console.error("Erreur lors du chargement des employ\xe9s:",c),i.current&&l(c.message),c}finally{i.current&&a(!1),p.current=!1}}}),[]),h=(0,t.useCallback)((async e=>{if(!i.current)return null;a(!0);try{const r=s.H$||"http://localhost:5004";console.log(`[fetchEmployeeById] Utilisation de l'URL: ${r}`);const o=localStorage.getItem("token");if(!o)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const t=await fetch(`${r}/api/employees/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors du chargement de l'employ\xe9")}return await t.json()}catch(c){return console.error(`Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9 ${e}:`,c),i.current&&l(c.message),null}finally{i.current&&a(!1)}}),[]),m=(0,t.useCallback)((async e=>{if(!i.current)return{success:!1};a(!0);try{const{hourlyRate:o,...t}=e,n=s.H$||"http://localhost:5004";console.log(`[createEmployee] Utilisation de l'URL: ${n}`);const a=localStorage.getItem("token");if(!a)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t)),u={};for(const e in c)"zipCode"===e?u.zip_code=c[e]:u[e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))]=c[e];const p=await fetch(`${n}/api/employees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(u)});if(!p.ok){const e=await p.json();throw new Error(e.message||"Erreur lors de la cr\xe9ation de l'employ\xe9")}const d=await p.json();return i.current&&(r((e=>[...e,d.employee||d])),l(null)),{success:!0,employee:d.employee||d,message:"Employ\xe9 cr\xe9\xe9 avec succ\xe8s"}}catch(c){return console.error("Erreur lors de la cr\xe9ation de l'employ\xe9:",c),i.current&&l(c.message),{success:!1,error:c.message||"Erreur lors de la cr\xe9ation de l'employ\xe9"}}finally{i.current&&a(!1)}}),[]),y=(0,t.useCallback)((async(e,o)=>{if(!i.current)return{success:!1};a(!0);try{const{hourlyRate:t,...n}=o,a=s.H$||"http://localhost:5004";console.log(`[updateEmployee] Utilisation de l'URL: ${a}`);const c=localStorage.getItem("token");if(!c)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const l=JSON.parse(JSON.stringify(n)),u={};for(const e in l)"zipCode"===e?u.zip_code=l[e]:u[e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))]=l[e];const p=await fetch(`${a}/api/employees/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(u)});if(!p.ok){const e=await p.json();throw new Error(e.message||"Erreur lors de la mise \xe0 jour de l'employ\xe9")}const d=await p.json();return i.current&&r((r=>r.map((r=>r.id===e?{...r,...d.employee||d}:r)))),{success:!0,message:"Employ\xe9 mis \xe0 jour avec succ\xe8s",data:d.employee||d}}catch(c){return console.error("Erreur lors de la mise \xe0 jour de l'employ\xe9:",c),i.current&&l(c.message),{success:!1,error:c.message||"Erreur lors de la mise \xe0 jour de l'employ\xe9"}}finally{i.current&&a(!1)}}),[]),g=(0,t.useCallback)((async e=>{if(!i.current)return{success:!1};a(!0);try{const o=s.H$||"http://localhost:5004";console.log(`[deleteEmployee] Utilisation de l'URL: ${o}`);const t=localStorage.getItem("token");if(!t)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const n=await fetch(`${o}/api/employees/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression de l'employ\xe9")}return i.current&&r((r=>r.filter((r=>r.id!==e)))),{success:!0,message:"Employ\xe9 supprim\xe9 avec succ\xe8s"}}catch(c){return console.error(`Erreur lors de la suppression de l'employ\xe9 ${e}:`,c),i.current&&l(c.message),{success:!1,error:c.message||"Erreur lors de la suppression de l'employ\xe9"}}finally{i.current&&a(!1)}}),[]),E=(0,t.useCallback)((r=>r&&"all"!==r?e.filter((e=>e.status===r)):e),[e]),w=(0,t.useCallback)((async e=>{if(!i.current)return 0;try{const o=Math.floor(200*Math.random());await new Promise((e=>setTimeout(e,o)));const t=await u.get(`/api/hour-balance/${e}`);if(!t||void 0===t.hour_balance&&void 0===t.balance)return console.warn(`Avertissement: Format de r\xe9ponse inattendu pour l'employ\xe9 #${e}`),0;{const o=void 0!==t.hour_balance?t.hour_balance:t.balance;return i.current&&r((r=>r.map((r=>r.id===e?{...r,hour_balance:o}:r)))),o}}catch(o){return console.warn(`Avertissement: Impossible de r\xe9cup\xe9rer le solde d'heures pour l'employ\xe9 #${e}`),0}}),[u]),f=(0,t.useCallback)((async()=>{if(i.current&&!window._isFetchingHourBalances)try{window._isFetchingHourBalances=!0;for(const r of e){if(!i.current)break;try{await w(r.id),await new Promise((e=>setTimeout(e,300)))}catch(c){console.warn(`Erreur pour l'employ\xe9 ${r.id}, continuons avec le suivant`)}}}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration des soldes d'heures:",r)}finally{window._isFetchingHourBalances=!1}}),[e,w]);(0,t.useEffect)((()=>{let e=0;const o=async()=>{if(e>=2||!i.current)i.current&&(l("Erreur lors du chargement des employ\xe9s apr\xe8s plusieurs tentatives"),a(!1));else try{if(!localStorage.getItem("token"))return console.error("Token d'authentification manquant"),void(i.current&&(l("Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 ces donn\xe9es"),a(!1)));const e=await u.get(s.Sn.EMPLOYEES.BASE);i.current&&(Array.isArray(e)?(r(e),l(null)):(console.error("Format de donn\xe9es invalide:",e),l("Format de donn\xe9es invalide")),a(!1))}catch(t){i.current&&(console.error("Erreur lors du chargement des employ\xe9s:",t),l(t.message||"Erreur lors du chargement des employ\xe9s"),e++,setTimeout(o,1e3*Math.pow(2,e)))}};return i.current&&o(),()=>{}}),[u]);const $=(0,t.useRef)(!1);return(0,t.useEffect)((()=>{if(e.length>0&&!$.current&&i.current){$.current=!0;const e=setTimeout((()=>{i.current&&f()}),1e3);return()=>clearTimeout(e)}}),[e.length,f]),{employees:e,loading:o,error:c,fetchEmployees:d,fetchEmployeeById:h,createEmployee:m,updateEmployee:y,deleteEmployee:g,getEmployeesByStatus:E,fetchEmployeeHourBalance:w,fetchAllEmployeesHourBalances:f}}},4634:(e,r,o)=>{o.d(r,{A:()=>a});var t=o(5043),s=o(3768),n=o(4583);const a=()=>{const e=(0,t.useCallback)((async e=>{try{const o={};e.headers.forEach(((e,r)=>{o[r]=e})),console.log("R\xe9ponse du serveur:",{url:e.url,status:e.status,statusText:e.statusText,headers:o});const t=e.headers.get("content-type");let n;if(t&&t.includes("application/json"))n=await e.json(),console.log("Donn\xe9es JSON re\xe7ues:",n);else{const o=await e.text();console.warn("R\xe9ponse non-JSON re\xe7ue:",o);try{n=JSON.parse(o),console.log("Texte pars\xe9 comme JSON:",n)}catch(r){n={message:o}}}if(e.ok)return n;{if(401===e.status||403===e.status){console.error("Erreur d'authentification:",n),s.oR.error("Session expir\xe9e ou acc\xe8s non autoris\xe9. Veuillez vous reconnecter.");const r=new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");throw r.status=e.status,r.response={status:e.status,data:n},r}500===e.status&&(console.error("Erreur serveur:",n),console.error("URL:",e.url),console.error("M\xe9thode:",e.method),n.error&&console.error("D\xe9tails de l'erreur:",n.error),n.stack&&console.error("Stack trace:",n.stack));const r=n.message||n.error||e.statusText||"Erreur inconnue",o=new Error(r);throw o.status=e.status,o.response={status:e.status,data:n},o}}catch(o){throw console.error("Erreur lors du traitement de la r\xe9ponse:",o),o}}),[]);return(0,t.useMemo)((()=>{const r=e=>{if("zipCode"===e)return console.log(`Conversion sp\xe9ciale: ${e} -> zip_code`),"zip_code";const r=e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));return console.log(`Conversion camelCase -> snake_case: ${e} -> ${r}`),r};return{get:async r=>{try{const o=n.H$||"http://localhost:5001";console.log(`[API] GET ${o}${r}`);const t=r.includes("/departments"),s=localStorage.getItem("token"),a={"Content-Type":"application/json",...s&&{Authorization:`Bearer ${s}`}},c=await fetch(`${o}${r}`,{method:"GET",headers:a});if(!t&&!c.ok){const e=await c.json();throw new Error(e.message||`Erreur lors de la requ\xeate GET ${r}`)}const l=await e(c);return t?{ok:c.ok,status:c.status,data:l,headers:c.headers}:l}catch(o){console.error(`[API] GET ${r} Error:`,o);if(r.includes("/departments"))return console.log("Erreur silencieuse pour les d\xe9partements"),{ok:!1,status:o.status||0,data:{message:o.message||"Erreur lors de la requ\xeate GET"},headers:new Headers};throw o}},post:async(o,t)=>{try{if(!t||"object"!==typeof t)throw console.error("Donn\xe9es invalides pour la requ\xeate POST:",t),new Error("Donn\xe9es invalides pour la requ\xeate POST");const s=n.H$||"http://localhost:5001";console.log(`[API] POST ${s}${o}`);const a=localStorage.getItem("token");if(!a)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t));void 0!==c.hourlyRate&&(console.log("Suppression de hourlyRate des donn\xe9es"),delete c.hourlyRate);const l={};for(const e in c)l[r(e)]=c[e];console.log("Donn\xe9es converties en snake_case pour POST:",l);const u={"Content-Type":"application/json",Authorization:`Bearer ${a}`};console.log("D\xe9tails de la requ\xeate POST:",{endpoint:o,dataSize:JSON.stringify(l).length,headers:{...u,Authorization:"Bearer [MASQU\xc9]"}});const i=new AbortController,p=setTimeout((()=>i.abort()),3e4),d=await fetch(`${s}${o}`,{method:"POST",headers:u,body:JSON.stringify(l),signal:i.signal});if(clearTimeout(p),401===d.status||403===d.status)throw console.error("Erreur d'authentification:",d.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");return e(d)}catch(s){if("AbortError"===s.name)throw console.error("La requ\xeate a \xe9t\xe9 interrompue (timeout):",s),new Error("La requ\xeate a pris trop de temps. Veuillez r\xe9essayer.");if(s.message.includes("NetworkError")||s.message.includes("Failed to fetch"))throw console.error("Erreur r\xe9seau lors de la requ\xeate POST:",s),new Error("Probl\xe8me de connexion au serveur, veuillez v\xe9rifier votre connexion internet");throw console.error("Erreur lors de la requ\xeate POST:",s),s}},put:async(o,t)=>{try{const s=n.H$||"http://localhost:5001";console.log(`[API] PUT ${s}${o}`,t);const a=localStorage.getItem("token");if(!a)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t));console.log("Donn\xe9es nettoy\xe9es:",c),void 0!==c.hourlyRate&&(console.log("Suppression de hourlyRate des donn\xe9es"),delete c.hourlyRate);const l={};for(const e in c)l[r(e)]=c[e];console.log("Donn\xe9es converties en snake_case:",l);const u=await fetch(`${s}${o}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(l)});if(401===u.status||403===u.status)throw console.error("Erreur d'authentification:",u.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const i=await e(u);return console.log(`[API] PUT ${o} Response:`,i),i}catch(s){return console.error(`[API] PUT ${o} Error:`,s),{ok:!1,status:s.status||0,data:{message:s.message||"Erreur lors de la requ\xeate PUT"},headers:new Headers}}},delete:async r=>{try{const o=n.H$||"http://localhost:5004";console.log(`[API] DELETE ${o}${r}`);const t=localStorage.getItem("token");if(!t)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const s=await fetch(`${o}${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(401===s.status||403===s.status)throw console.error("Erreur d'authentification:",s.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const a=await e(s);return console.log(`[API] DELETE ${r} Response:`,a),a}catch(o){return console.error(`[API] DELETE ${r} Error:`,o),{ok:!1,status:o.status||0,data:{message:o.message||"Erreur lors de la requ\xeate DELETE"},headers:new Headers}}}}}),[e])}}}]);
//# sourceMappingURL=479.6fb62f01.chunk.js.map