"use strict";(self.webpackChunksmartplanning_ai=self.webpackChunksmartplanning_ai||[]).push([[351],{290:(e,t,r)=>{r.d(t,{A:()=>l});var n=r(5043),s=r(3768),a=r(4583),o=r(4634);const l=()=>{const[e,t]=(0,n.useState)([]),[r,l]=(0,n.useState)(!0),[d,c]=(0,n.useState)(null),i=(0,o.A)(),u=(0,n.useRef)(!0),p=(0,n.useRef)(null);(0,n.useEffect)((()=>(u.current=!0,()=>{u.current=!1,p.current&&(clearInterval(p.current),p.current=null)})),[]);const m=(0,n.useCallback)((async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=null,s=0;for(;s<t;)try{return await e()}catch(a){if(n=a,s++,s<t){const e=r*Math.pow(2,s-1);console.log(`Tentative ${s}/${t} \xe9chou\xe9e, nouvelle tentative dans ${e}ms`),await new Promise((t=>setTimeout(t,e)))}}throw n}),[]),h=(0,n.useCallback)((async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!u.current)return;let r=0;const n=localStorage.getItem("cachedVacations"),s=localStorage.getItem("cachedVacationsTimestamp");if(!e&&n&&s){if((new Date).getTime()-parseInt(s)<3e5)try{const e=JSON.parse(n);return console.log("Utilisation des donn\xe9es en cache pour les cong\xe9s"),void(u.current&&(t(e),l(!1)))}catch(d){console.error("Erreur lors de la lecture du cache:",d)}}const o=async()=>{if(r>=2||!u.current)u.current&&(c("Erreur lors du chargement des cong\xe9s apr\xe8s plusieurs tentatives"),l(!1));else try{console.log("Chargement des cong\xe9s...");if(!localStorage.getItem("token"))return console.error("Token d'authentification manquant"),void(u.current&&(c("Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 ces donn\xe9es"),l(!1)));const e=await i.get(a.Sn.VACATIONS);if(console.log("Donn\xe9es des cong\xe9s re\xe7ues:",e),!u.current)return;if(Array.isArray(e)){const r=e.map((e=>{const t=e.start_date||e.startDate,r=e.end_date||e.endDate;let n="-";if(t&&r){const e=new Date(t),s=new Date(r);e.setHours(0,0,0,0),s.setHours(0,0,0,0);let a=0;const o=new Date(e);for(;o<=s;)0!==o.getDay()&&a++,o.setDate(o.getDate()+1);n=`${a} jour${a>1?"s":""} ouvrable${a>1?"s":""}`}return{...e,employeeName:e.employee_name||e.employeeName||"Employ\xe9 inconnu",startDate:t,endDate:r,duration:n,employeeId:e.employee_id||e.employeeId,approvedAt:e.approved_at||e.approvedAt,approvedBy:e.approved_by||e.approvedBy,rejectedAt:e.rejected_at||e.rejectedAt,rejectedBy:e.rejected_by||e.rejectedBy,rejectionReason:e.rejection_reason||e.rejectionReason,createdAt:e.created_at||e.createdAt,updatedAt:e.updated_at||e.updatedAt}}));console.log("Donn\xe9es des cong\xe9s format\xe9es:",r),u.current&&(t(r),c(null));try{localStorage.setItem("cachedVacations",JSON.stringify(r)),localStorage.setItem("cachedVacationsTimestamp",(new Date).getTime().toString())}catch(d){console.error("Erreur lors de la mise en cache des donn\xe9es:",d)}}else console.error("Format de donn\xe9es invalide:",e),u.current&&c("Format de donn\xe9es invalide");u.current&&l(!1)}catch(e){console.error("Erreur lors du chargement des cong\xe9s:",e),u.current&&c(e.message||"Erreur lors du chargement des cong\xe9s"),r++;const t=500*Math.pow(2,r);console.log(`Nouvelle tentative dans ${t}ms (${r}/2)`);const n=setTimeout((()=>{u.current&&o()}),t);return()=>clearTimeout(n)}};u.current&&(l(!0),c(null)),await o()}),[i]);(0,n.useEffect)((()=>(h(),p.current=setInterval((()=>{u.current&&(console.log("Rafra\xeechissement p\xe9riodique des donn\xe9es de cong\xe9s"),h(!0))}),6e4),()=>{p.current&&(clearInterval(p.current),p.current=null)})),[h]);const x=(0,n.useCallback)((async e=>{try{if(l(!0),c(null),console.log("Donn\xe9es originales de la demande de cong\xe9:",e),!e.employeeId&&!e.employee_id){const e="L'identifiant de l'employ\xe9 est requis";return s.oR.error(e),l(!1),{success:!1,error:e}}if(!e.startDate&&!e.start_date||!e.endDate&&!e.end_date){const e="Les dates de d\xe9but et de fin sont requises";return s.oR.error(e),l(!1),{success:!1,error:e}}const r={employee_id:e.employeeId||e.employee_id,start_date:e.startDate||e.start_date,end_date:e.endDate||e.end_date,type:e.type||"paid",reason:e.reason||"",status:"pending"};if(r.start_date&&!r.start_date.includes("-")){const e=new Date(r.start_date);r.start_date=e.toISOString().split("T")[0]}if(r.end_date&&!r.end_date.includes("-")){const e=new Date(r.end_date);r.end_date=e.toISOString().split("T")[0]}console.log("Donn\xe9es format\xe9es pour la cr\xe9ation de cong\xe9:",r);const n=localStorage.getItem("token");console.log("Token d'authentification pr\xe9sent:",!!n);const o=async()=>{try{const e=await i.post(a.Sn.VACATIONS,r);return console.log("R\xe9ponse de l'API:",e),t((t=>[...t,e])),s.oR.success("Demande de cong\xe9 cr\xe9\xe9e avec succ\xe8s"),{success:!0,data:e}}catch(d){var e,n,o,l;console.error("Erreur lors de la cr\xe9ation de la demande de cong\xe9:",d);const r=(null===(e=d.response)||void 0===e||null===(n=e.data)||void 0===n?void 0:n.message)||(null===(o=d.response)||void 0===o||null===(l=o.data)||void 0===l?void 0:l.error)||d.message||"Erreur lors de la cr\xe9ation de la demande de cong\xe9";throw s.oR.error(r),c(r),d}},u=await m(o,2,1e3);return l(!1),h(!0),u}catch(d){return console.error("Erreur finale lors de la cr\xe9ation de la demande de cong\xe9:",d),l(!1),c(d.message||"Erreur lors de la cr\xe9ation de la demande de cong\xe9"),{success:!1,error:d.message}}}),[i,m,h]),g=(0,n.useCallback)((async(e,r)=>{try{const n=async()=>{const t=await i.put(`${a.Sn.VACATIONS}/${e}`,r);var n;if(t&&"object"===typeof t&&"ok"in t&&!t.ok)throw new Error((null===(n=t.data)||void 0===n?void 0:n.message)||"Erreur lors de la mise \xe0 jour de la demande de cong\xe9");return t},o=await m(n);return t((t=>t.map((t=>t.id===e?o:t)))),s.oR.success("Demande de cong\xe9 mise \xe0 jour avec succ\xe8s"),h(!0),{success:!0,vacation:o}}catch(n){console.error("Erreur lors de la mise \xe0 jour de la demande de cong\xe9:",n);const e=n.message||"Erreur inconnue";return s.oR.error(`Erreur lors de la mise \xe0 jour de la demande de cong\xe9: ${e}`),{success:!1,error:e}}}),[i,m,h]),j=(0,n.useCallback)((async e=>{try{const r=async()=>{const t=await i.delete(`${a.Sn.VACATIONS}/${e}`);var r;if(t&&"object"===typeof t&&"ok"in t&&!t.ok)throw new Error((null===(r=t.data)||void 0===r?void 0:r.message)||"Erreur lors de la suppression de la demande de cong\xe9");return t};return await m(r),t((t=>t.filter((t=>t.id!==e)))),s.oR.success("Demande de cong\xe9 supprim\xe9e avec succ\xe8s"),h(!0),{success:!0}}catch(r){console.error("Erreur lors de la suppression de la demande de cong\xe9:",r);const e=r.message||"Erreur inconnue";return s.oR.error(`Erreur lors de la suppression de la demande de cong\xe9: ${e}`),{success:!1,error:e}}}),[i,m,h]),A=(0,n.useCallback)((async function(e,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{const o=async()=>{const t=await i.put(`${a.Sn.VACATIONS}/${e}/status`,{status:r,comment:n});var s;if(t&&"object"===typeof t&&"ok"in t&&!t.ok)throw new Error((null===(s=t.data)||void 0===s?void 0:s.message)||`Erreur lors de la ${"approved"===r?"validation":"rejet"} de la demande de cong\xe9`);return t},l=await m(o);return t((t=>t.map((t=>t.id===e?l:t)))),s.oR.success(`Demande de cong\xe9 ${"approved"===r?"approuv\xe9e":"rejet\xe9e"} avec succ\xe8s`),h(!0),{success:!0,vacation:l}}catch(o){console.error(`Erreur lors de la ${"approved"===r?"validation":"rejet"} de la demande de cong\xe9:`,o);const e=o.message||"Erreur inconnue";return s.oR.error(`Erreur lors de la ${"approved"===r?"validation":"rejet"} de la demande de cong\xe9: ${e}`),{success:!1,error:e}}}),[i,m,h]),y=(0,n.useCallback)((t=>t?e.filter((e=>e.status===t)):e),[e]),v=(0,n.useCallback)((()=>h(!0)),[h]);return{vacations:e,loading:r,error:d,fetchVacations:h,refreshVacations:v,createVacation:x,updateVacation:g,deleteVacation:j,updateVacationStatus:A,getVacationsByStatus:y,approveVacation:e=>A(e,"approved"),rejectVacation:(e,t)=>A(e,"rejected",t)}}},5351:(e,t,r)=>{r.r(t),r.d(t,{default:()=>de});var n=r(7805),s=r(141),a=r(6240),o=r(3600),l=r(622),d=r(8903),c=r(3336),i=r(6946),u=r(5865),p=r(3404),m=r(8939),h=r(4056),x=r(5043),g=r(3768),j=r(4194),A=r(3216),y=r(579);const v=e=>{let{message:t,onRetry:r,showHomeButton:n=!0}=e;const s=(0,A.Zp)();return(0,y.jsx)(l.A,{maxWidth:"md",sx:{mt:8,mb:8},children:(0,y.jsxs)(c.A,{elevation:3,sx:{p:4,borderRadius:2,display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center"},children:[(0,y.jsx)(u.A,{variant:"h4",component:"h1",gutterBottom:!0,color:"error",children:"Oups ! Une erreur est survenue"}),(0,y.jsx)(i.A,{sx:{width:"100%",mt:2,mb:4},children:(0,y.jsx)(j.A,{severity:"error",sx:{mb:2},children:t||"Une erreur inattendue s'est produite. Veuillez r\xe9essayer ult\xe9rieurement."})}),(0,y.jsxs)(i.A,{sx:{display:"flex",gap:2,mt:2},children:[r&&(0,y.jsx)(p.A,{variant:"contained",color:"primary",onClick:r,children:"R\xe9essayer"}),n&&(0,y.jsx)(p.A,{variant:"outlined",color:"primary",onClick:()=>{s("/")},children:"Retour \xe0 l'accueil"})]})]})})};var f=r(1637);const D=e=>{let{message:t="Chargement en cours...",size:r=60}=e;return(0,y.jsxs)(l.A,{maxWidth:"xl",sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",minHeight:"50vh",py:8},children:[(0,y.jsx)(f.A,{size:r,thickness:4,color:"primary",sx:{mb:3}}),(0,y.jsxs)(i.A,{sx:{textAlign:"center"},children:[(0,y.jsx)(u.A,{variant:"h6",component:"h2",color:"text.secondary",sx:{animation:"pulse 1.5s infinite ease-in-out","@keyframes pulse":{"0%":{opacity:.6},"50%":{opacity:1},"100%":{opacity:.6}}},children:t}),(0,y.jsx)(u.A,{variant:"body2",color:"text.secondary",sx:{mt:2,maxWidth:500,mx:"auto"},children:"Merci de patienter pendant que nous chargeons vos donn\xe9es..."})]})]})};var b=r(9336);const w=e=>{let{title:t,subtitle:r,icon:n,action:s}=e;return(0,y.jsxs)(i.A,{sx:{mb:4},children:[(0,y.jsxs)(i.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mb:1},children:[(0,y.jsxs)(i.A,{sx:{display:"flex",alignItems:"center"},children:[n&&(0,y.jsx)(i.A,{sx:{fontSize:{xs:"2rem",md:"2.5rem"},mr:2,display:"flex",alignItems:"center"},children:n}),(0,y.jsxs)(i.A,{children:[(0,y.jsx)(u.A,{variant:"h4",component:"h1",sx:{fontWeight:"bold",fontSize:{xs:"1.5rem",sm:"2rem",md:"2.25rem"}},children:t}),r&&(0,y.jsx)(u.A,{variant:"subtitle1",color:"text.secondary",sx:{mt:.5},children:r})]})]}),s&&(0,y.jsx)(i.A,{sx:{ml:2},children:s})]}),(0,y.jsx)(b.A,{sx:{mt:2,mb:3}})]})};var S=r(1081),C=r(6600),I=r(5316),k=r(3193),E=r(9190),R=r(598),_=r(7970),V=r(1673),$=r(7784),T=r(9347),z=r(7776),O=r(6062),M=r(8390),N=r(4089),P=r(3418),W=r(5016),U=r(2479),L=r(1734);const q=e=>{let{open:t,onClose:r,onSubmit:n,vacation:s,currentUser:a}=e;const{user:o}=(0,W.A)(),{employees:l,loading:c}=(0,U.A)(),[i,u]=(0,x.useState)({employeeId:"",startDate:null,endDate:null,type:"paid",reason:""}),[m,h]=(0,x.useState)({}),[g,j]=(0,x.useState)(""),[A,v]=(0,x.useState)(0),[f,D]=(0,x.useState)(!1);(0,x.useEffect)((()=>{u(s?{employeeId:s.employeeId||"",startDate:s.startDate?new Date(s.startDate):null,endDate:s.endDate?new Date(s.endDate):null,type:s.type||"paid",reason:s.reason||""}:{employeeId:(null===a||void 0===a?void 0:a.id)||"",startDate:null,endDate:null,type:"paid",reason:""}),h({})}),[s,a]);const b=e=>{const{name:t,value:r}=e.target;u((e=>({...e,[t]:r}))),m[t]&&h((e=>({...e,[t]:null})))},w=(e,t)=>{u((r=>({...r,[e]:t}))),m[e]&&h((t=>({...t,[e]:null})))};(0,x.useEffect)((()=>{if(i.startDate&&i.endDate){const e=new Date(i.startDate),t=new Date(i.endDate);if(t<e)return h((e=>({...e,endDate:"La date de fin doit \xeatre apr\xe8s la date de d\xe9but"}))),void v(0);const r=(0,L.Q$)(e,t);if(v(r),h((e=>({...e,endDate:null}))),"paid"===i.type||"rtt"===i.type){const e=P.y6.find((e=>e.value===i.type)),t=e?e.defaultQuota:0;D(r>t)}else D(!1)}else v(0),D(!1)}),[i.startDate,i.endDate,i.type]);return(0,y.jsxs)(S.A,{open:t,onClose:r,maxWidth:"sm",fullWidth:!0,"aria-labelledby":"vacation-form-dialog-title",children:[(0,y.jsx)(C.A,{id:"vacation-form-dialog-title",children:s?"Modifier la demande de cong\xe9":"Nouvelle demande de cong\xe9"}),(0,y.jsx)(I.A,{children:(0,y.jsx)(M.$,{dateAdapter:z.h,adapterLocale:N.A,children:(0,y.jsxs)(d.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,y.jsx)(d.Ay,{item:!0,xs:12,children:(0,y.jsxs)(k.A,{fullWidth:!0,error:!!m.type,children:[(0,y.jsx)(E.A,{id:"type-label",children:"Type de cong\xe9"}),(0,y.jsx)(R.A,{labelId:"type-label",id:"type",name:"type",value:i.type,onChange:b,label:"Type de cong\xe9",children:P.y6.map((e=>(0,y.jsx)(_.A,{value:e.value,children:e.label},e.value)))}),m.type&&(0,y.jsx)(V.A,{children:m.type})]})}),(0,y.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,y.jsx)(O.l,{label:"Date de d\xe9but",value:i.startDate,onChange:e=>w("startDate",e),slotProps:{textField:{fullWidth:!0,error:!!m.startDate,helperText:m.startDate}}})}),(0,y.jsx)(d.Ay,{item:!0,xs:12,sm:6,children:(0,y.jsx)(O.l,{label:"Date de fin",value:i.endDate,onChange:e=>w("endDate",e),slotProps:{textField:{fullWidth:!0,error:!!m.endDate,helperText:m.endDate}}})}),(0,y.jsx)(d.Ay,{item:!0,xs:12,children:(0,y.jsx)($.A,{id:"reason",name:"reason",label:"Motif (optionnel)",multiline:!0,rows:3,fullWidth:!0,value:i.reason,onChange:b,error:!!m.reason,helperText:m.reason})})]})})}),(0,y.jsxs)(T.A,{children:[(0,y.jsx)(p.A,{onClick:r,children:"Annuler"}),(0,y.jsx)(p.A,{onClick:()=>{if((()=>{const e={};return i.employeeId||(e.employeeId="L'identifiant de l'employ\xe9 est requis"),i.startDate||(e.startDate="La date de d\xe9but est requise"),i.endDate||(e.endDate="La date de fin est requise"),i.startDate&&i.endDate&&i.startDate>i.endDate&&(e.endDate="La date de fin doit \xeatre post\xe9rieure \xe0 la date de d\xe9but"),h(e),0===Object.keys(e).length})()){const e={...i,startDate:i.startDate?i.startDate.toISOString().split("T")[0]:null,endDate:i.endDate?i.endDate.toISOString().split("T")[0]:null};n(e)}},variant:"contained",color:"primary",children:s?"Mettre \xe0 jour":"Cr\xe9er"})]})]})};var B=r(3560),F=r(6625),H=r(8606),J=r(1794),Q=r(9650),G=r(1806),Z=r(4882),K=r(8076),X=r(39),Y=r(3460),ee=r(3845),te=r(7739),re=r(7392),ne=r(2598),se=r(8533),ae=r(9525);const oe=e=>{let{vacations:t,onEdit:r,onDelete:n,onApprove:s,onReject:l,currentUser:d}=e;const m=(0,a.A)(),h=(0,o.A)(m.breakpoints.down("md")),[g,j]=(0,x.useState)(0),[A,v]=(0,x.useState)(10),[f,D]=(0,x.useState)(!1),[b,w]=(0,x.useState)(!1),[k,E]=(0,x.useState)(null),[R,_]=(0,x.useState)(""),V=()=>{D(!1),E(null)},z=()=>{w(!1),E(null),_("")},O=e=>{if(!e)return"-";try{return(0,ae.A)(new Date(e),"dd MMMM yyyy",{locale:N.A})}catch(t){return console.error("Erreur lors du formatage de la date:",t),e}},M=e=>{switch(e){case"pending":return"warning";case"approved":return"success";case"rejected":return"error";default:return"default"}},P=e=>{switch(e){case"pending":return"En attente";case"approved":return"Approuv\xe9";case"rejected":return"Rejet\xe9";default:return e}},W=e=>d&&e.employeeId===d.id&&"pending"===e.status,U=e=>d&&e.employeeId===d.id&&"pending"===e.status,L=e=>d&&"admin"===d.role&&"pending"===e.status;return t&&0!==t.length?(0,y.jsxs)(i.A,{children:[(0,y.jsx)(Q.A,{component:c.A,sx:{boxShadow:"none"},children:(0,y.jsxs)(G.A,{size:h?"small":"medium",children:[(0,y.jsx)(Z.A,{children:(0,y.jsxs)(K.A,{children:[(0,y.jsx)(X.A,{children:"Employ\xe9"}),(0,y.jsx)(X.A,{children:"Date de d\xe9but"}),(0,y.jsx)(X.A,{children:"Date de fin"}),(0,y.jsx)(X.A,{children:"Dur\xe9e"}),(0,y.jsx)(X.A,{children:"Statut"}),(0,y.jsx)(X.A,{align:"right",children:"Actions"})]})}),(0,y.jsx)(Y.A,{children:t.slice(g*A,g*A+A).map((e=>(0,y.jsxs)(K.A,{children:[(0,y.jsx)(X.A,{children:e.employeeName}),(0,y.jsx)(X.A,{children:O(e.startDate)}),(0,y.jsx)(X.A,{children:O(e.endDate)}),(0,y.jsx)(X.A,{children:e.duration}),(0,y.jsx)(X.A,{children:(0,y.jsx)(ee.A,{label:P(e.status),color:M(e.status),size:"small"})}),(0,y.jsx)(X.A,{align:"right",children:(0,y.jsxs)(i.A,{sx:{display:"flex",justifyContent:"flex-end"},children:[W(e)&&(0,y.jsx)(te.A,{title:"Modifier",children:(0,y.jsx)(re.A,{size:"small",onClick:()=>r(e),children:(0,y.jsx)(B.A,{fontSize:"small"})})}),U(e)&&(0,y.jsx)(te.A,{title:"Supprimer",children:(0,y.jsx)(re.A,{size:"small",onClick:()=>(e=>{E(e),D(!0)})(e),children:(0,y.jsx)(F.A,{fontSize:"small"})})}),L(e)&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(te.A,{title:"Approuver",children:(0,y.jsx)(re.A,{size:"small",color:"success",onClick:()=>s(e.id),children:(0,y.jsx)(H.A,{fontSize:"small"})})}),(0,y.jsx)(te.A,{title:"Rejeter",children:(0,y.jsx)(re.A,{size:"small",color:"error",onClick:()=>(e=>{E(e),w(!0),_("")})(e),children:(0,y.jsx)(J.A,{fontSize:"small"})})})]})]})})]},e.id)))})]})}),(0,y.jsx)(ne.A,{rowsPerPageOptions:[5,10,25],component:"div",count:t.length,rowsPerPage:A,page:g,onPageChange:(e,t)=>{j(t)},onRowsPerPageChange:e=>{v(parseInt(e.target.value,10)),j(0)},labelRowsPerPage:"Lignes par page:",labelDisplayedRows:e=>{let{from:t,to:r,count:n}=e;return`${t}-${r} sur ${n}`}}),(0,y.jsxs)(S.A,{open:f,onClose:V,"aria-labelledby":"delete-dialog-title","aria-describedby":"delete-dialog-description",children:[(0,y.jsx)(C.A,{id:"delete-dialog-title",children:"Confirmer la suppression"}),(0,y.jsx)(I.A,{children:(0,y.jsx)(se.A,{id:"delete-dialog-description",children:"\xcates-vous s\xfbr de vouloir supprimer cette demande de cong\xe9 ? Cette action est irr\xe9versible."})}),(0,y.jsxs)(T.A,{children:[(0,y.jsx)(p.A,{onClick:V,children:"Annuler"}),(0,y.jsx)(p.A,{onClick:()=>{k&&n(k.id),V()},color:"error",autoFocus:!0,children:"Supprimer"})]})]}),(0,y.jsxs)(S.A,{open:b,onClose:z,"aria-labelledby":"reject-dialog-title","aria-describedby":"reject-dialog-description",children:[(0,y.jsx)(C.A,{id:"reject-dialog-title",children:"Motif de rejet de la demande"}),(0,y.jsxs)(I.A,{children:[(0,y.jsx)(se.A,{id:"reject-dialog-description",children:"Veuillez indiquer le motif du rejet de cette demande de cong\xe9."}),(0,y.jsx)($.A,{autoFocus:!0,margin:"dense",id:"rejectionReason",label:"Motif du rejet",type:"text",fullWidth:!0,multiline:!0,rows:3,value:R,onChange:e=>_(e.target.value)})]}),(0,y.jsxs)(T.A,{children:[(0,y.jsx)(p.A,{onClick:z,children:"Annuler"}),(0,y.jsx)(p.A,{onClick:()=>{k&&l(k.id,R),z()},color:"error",disabled:!R.trim(),children:"Rejeter"})]})]})]}):(0,y.jsx)(c.A,{sx:{p:3,textAlign:"center"},children:(0,y.jsx)(u.A,{variant:"body1",color:"text.secondary",children:"Aucune demande de cong\xe9 disponible."})})};var le=r(290);const de=()=>{const e=(0,a.A)(),t=(0,o.A)(e.breakpoints.down("md")),[r,j]=(0,x.useState)(0),[A,f]=(0,x.useState)(!1),[b,S]=(0,x.useState)(null),[C,I]=(0,x.useState)(!1),{user:k}=(0,W.A)(),{vacations:E,loading:R,error:_,createVacation:V,updateVacation:$,deleteVacation:T,updateVacationStatus:z,getVacationsByStatus:O,refreshVacations:M}=(0,le.A)();(0,x.useEffect)((()=>()=>{}),[]);const N=()=>{f(!1),S(null)};return R&&!C?(0,y.jsx)(D,{message:"Chargement des cong\xe9s..."}):_&&!C?(0,y.jsx)(v,{message:_}):(0,y.jsxs)(l.A,{maxWidth:"xl",sx:{mt:4,mb:4},children:[(0,y.jsx)(w,{title:"Gestion des cong\xe9s",subtitle:"Consultez et g\xe9rez les demandes de cong\xe9s",icon:"\ud83c\udfd6\ufe0f"}),(0,y.jsx)(d.Ay,{container:!0,spacing:3,children:(0,y.jsx)(d.Ay,{item:!0,xs:12,children:(0,y.jsxs)(c.A,{sx:{p:2,display:"flex",flexDirection:"column",borderRadius:2,boxShadow:3},children:[(0,y.jsxs)(i.A,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},children:[(0,y.jsx)(u.A,{variant:"h6",component:"h2",children:"Liste des demandes de cong\xe9s"}),(0,y.jsxs)(i.A,{children:[(0,y.jsx)(p.A,{variant:"outlined",color:"primary",startIcon:(0,y.jsx)(n.A,{}),onClick:async()=>{I(!0);try{await M(),g.oR.success("Donn\xe9es des cong\xe9s rafra\xeechies")}catch(_){g.oR.error("Erreur lors du rafra\xeechissement des donn\xe9es")}finally{I(!1)}},disabled:C,sx:{mr:1},children:C?"Rafra\xeechissement...":"Rafra\xeechir"}),(0,y.jsx)(p.A,{variant:"contained",color:"primary",startIcon:(0,y.jsx)(s.A,{}),onClick:()=>{S(null),f(!0)},children:"Nouvelle demande"})]})]}),(0,y.jsxs)(m.A,{value:r,onChange:(e,t)=>{j(t)},indicatorColor:"primary",textColor:"primary",variant:t?"scrollable":"fullWidth",scrollButtons:!!t&&"auto",sx:{mb:2},children:[(0,y.jsx)(h.A,{label:"Tous"}),(0,y.jsx)(h.A,{label:"En attente"}),(0,y.jsx)(h.A,{label:"Approuv\xe9s"}),(0,y.jsx)(h.A,{label:"Rejet\xe9s"})]}),(0,y.jsx)(oe,{vacations:(()=>{switch(r){case 0:default:return E;case 1:return O("pending");case 2:return O("approved");case 3:return O("rejected")}})(),onEdit:e=>{S(e),f(!0)},onDelete:async e=>{try{await T(e)}catch(_){console.error("Erreur lors de la suppression du cong\xe9:",_),g.oR.error("Une erreur est survenue lors de la suppression du cong\xe9")}},onApprove:async e=>{try{await z(e,"approved")}catch(_){console.error("Erreur lors de l'approbation du cong\xe9:",_),g.oR.error("Une erreur est survenue lors de l'approbation du cong\xe9")}},onReject:async(e,t)=>{try{await z(e,"rejected",t)}catch(_){console.error("Erreur lors du rejet du cong\xe9:",_),g.oR.error("Une erreur est survenue lors du rejet du cong\xe9")}},currentUser:k})]})})}),(0,y.jsx)(q,{open:A,onClose:N,onSubmit:async e=>{try{b?await $(b.id,e):await V(e),N()}catch(_){console.error("Erreur lors de la soumission du formulaire:",_),g.oR.error("Une erreur est survenue lors de la soumission du formulaire")}},vacation:b,currentUser:k})]})}}}]);
//# sourceMappingURL=351.1679fdd8.chunk.js.map