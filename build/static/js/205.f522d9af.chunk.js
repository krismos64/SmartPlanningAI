"use strict";(self.webpackChunksmartplanning_ai=self.webpackChunksmartplanning_ai||[]).push([[205],{1291:(e,r,t)=>{t.d(r,{AD:()=>f,J4:()=>h,Q$:()=>S,Ww:()=>p,Yq:()=>i,Z1:()=>w,cM:()=>y,rL:()=>m,rm:()=>d,vn:()=>g,w_:()=>E});var o=t(9734),a=t(1620),n=t(8605),s=t(1821),l=t(6981),c=t(2227),u=t(3418);const i=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dd/MM/yyyy";if(!e)return"";try{const t=e instanceof Date?e:new Date(e);return isNaN(t.getTime())?(console.error("Date invalide dans formatDate:",e),""):(0,o.GP)(t,r,{locale:c.fr})}catch(t){return console.error("Erreur lors du formatage de la date:",t,e),""}},d=e=>e?(0,o.GP)(e,"yyyy-MM-dd"):"",m=e=>(0,a.k)(e,{weekStartsOn:1}),p=e=>(0,n.$)(e,{weekStartsOn:1}),h=(e,r)=>(0,s.J)(e,r),g=e=>{const r=m(e),t=[];for(let o=0;o<7;o++)t.push((0,l.f)(r,o));return t},y=e=>{const r=new Date(e).getDay();return 0===r||6===r},E=(e,r)=>{if(!e||!r)return 0;const t=(r.getTime()-e.getTime())/36e5;return Math.round(10*t)/10},f=function(e){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const t=new Date(e).getDay();return r?["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"][t]:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"][t]},w=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.YX;if(!e)return!1;const t=new Date(e);if(isNaN(t.getTime()))return!1;const o=(e=>{if(!e)return"";const r=new Date(e);return`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}-${String(r.getDate()).padStart(2,"0")}`})(t);return r.some((e=>e.date===o))},v=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:u.YX;return!y(e)&&!w(e,r)},S=function(e,r){let t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:u.YX;if(!e||!r)return 0;const o=new Date(e),a=new Date(r);if(isNaN(o.getTime())||isNaN(a.getTime()))return 0;if(a<o)return 0;let n=0;const s=new Date(o);for(;s<=a;)v(s,t)&&n++,s.setDate(s.getDate()+1);return n}},2479:(e,r,t)=>{t.d(r,{A:()=>l});var o=t(5043),a=t(3768),n=t(4227),s=t(4634);const l=()=>{const[e,r]=(0,o.useState)([]),[t,l]=(0,o.useState)(!0),[c,u]=(0,o.useState)(null),i=(0,s.A)(),d=(0,o.useCallback)((async()=>{t||l(!0);try{const t=await i.get(n.Sn.EMPLOYEES.BASE);var e;if(!t.ok)throw new Error((null===(e=t.data)||void 0===e?void 0:e.message)||"Erreur lors du chargement des employ\xe9s");{const e=Array.isArray(t.data)?t.data:[];r(e),u(null)}}catch(o){console.error("Erreur lors du chargement des employ\xe9s:",o),u("Erreur lors du chargement des employ\xe9s"),a.oR.error("Erreur lors du chargement des employ\xe9s"),r([])}finally{l(!1)}}),[i,t]),m=(0,o.useCallback)((async e=>{l(!0),u(null);try{const t=await i.get(n.Sn.EMPLOYEES.BY_ID(e));if(t.ok)return t.data;var r;throw new Error((null===(r=t.data)||void 0===r?void 0:r.message)||"Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9")}catch(t){return console.error(`Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9 #${e}:`,t),u(t.message||"Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9"),a.oR.error("Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9"),null}finally{l(!1)}}),[i]),p=(0,o.useCallback)((async e=>{l(!0);try{const t=await i.post(n.Sn.EMPLOYEES.BASE,e);if(t&&t.id)return r((e=>[...e,t])),u(null),t;if(t&&"object"===typeof t){if(t.message&&t.message.includes("erreur"))return{success:!1,error:t.message};if(t.id)return r((e=>[...e,t])),{success:!0,employee:t}}return r((e=>[...e,t])),{success:!0,employee:t}}catch(t){console.error("Erreur lors de la cr\xe9ation de l'employ\xe9:",t);let e="Erreur lors de la cr\xe9ation de l'employ\xe9";return t.response&&t.response.data?e=t.response.data.message||e:t.message&&(e=t.message),{success:!1,error:e}}finally{l(!1)}}),[i]),h=(0,o.useCallback)((async(e,t)=>{l(!0);try{const o=await i.put(`${n.Sn.EMPLOYEES.BASE}/${e}`,t);if(o)return r((r=>r.map((r=>r.id===e?{...r,...o.data}:r)))),u(null),o.data}catch(o){return console.error("Erreur lors de la mise \xe0 jour de l'employ\xe9:",o),{success:!1,error:o.message||"Erreur inconnue"}}finally{l(!1)}}),[i]),g=(0,o.useCallback)((async e=>{l(!0);try{const t=await i.delete(`${n.Sn.EMPLOYEES.BASE}/${e}`);if(t)return r((r=>r.filter((r=>r.id!==e)))),{success:!0};{const e=(null===t||void 0===t?void 0:t.message)||"Erreur lors de la suppression de l'employ\xe9";return console.error("Erreur API:",e),{success:!1,error:e}}}catch(t){return console.error("Erreur lors de la suppression de l'employ\xe9:",t),{success:!1,error:t.message||"Erreur inconnue"}}finally{l(!1)}}),[i]),y=(0,o.useCallback)((r=>r&&"all"!==r?e.filter((e=>e.status===r)):e),[e]),E=(0,o.useCallback)((async e=>{try{const t=Math.floor(200*Math.random());await new Promise((e=>setTimeout(e,t)));const o=await i.get(`/api/hour-balance/${e}`);if(!o||void 0===o.hour_balance&&void 0===o.balance)return console.warn(`Avertissement: Format de r\xe9ponse inattendu pour l'employ\xe9 #${e}`),0;{const t=void 0!==o.hour_balance?o.hour_balance:o.balance;return r((r=>r.map((r=>r.id===e?{...r,hour_balance:t}:r)))),t}}catch(t){return console.warn(`Avertissement: Impossible de r\xe9cup\xe9rer le solde d'heures pour l'employ\xe9 #${e}`),0}}),[i,r]),f=(0,o.useCallback)((async()=>{if(!window._isFetchingHourBalances)try{window._isFetchingHourBalances=!0;for(const r of e)try{await E(r.id),await new Promise((e=>setTimeout(e,300)))}catch(c){console.warn(`Erreur pour l'employ\xe9 ${r.id}, continuons avec le suivant`)}}catch(r){console.error("Erreur lors de la r\xe9cup\xe9ration des soldes d'heures:",r)}finally{window._isFetchingHourBalances=!1}}),[e,E]);(0,o.useEffect)((()=>{let e=!0,t=0;const o=async()=>{if(t>=3)e&&(u("Erreur lors du chargement des employ\xe9s apr\xe8s plusieurs tentatives"),l(!1));else try{if(!localStorage.getItem("token"))return console.error("Token d'authentification manquant"),u("Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 ces donn\xe9es"),void l(!1);const t=await i.get(n.Sn.EMPLOYEES.BASE);e&&(Array.isArray(t)?(r(t),u(null)):(console.error("Format de donn\xe9es invalide:",t),u("Format de donn\xe9es invalide")),l(!1))}catch(a){e&&(console.error("Erreur lors du chargement des employ\xe9s:",a),u(a.message||"Erreur lors du chargement des employ\xe9s"),t++,setTimeout(o,1e3*Math.pow(2,t)))}};return o(),()=>{e=!1}}),[i]);const w=(0,o.useRef)(!1);return(0,o.useEffect)((()=>{if(e.length>0&&!w.current){w.current=!0;const e=setTimeout((()=>{f()}),1e3);return()=>clearTimeout(e)}}),[e.length,f]),{employees:e,loading:t,error:c,fetchEmployees:d,fetchEmployeeById:m,createEmployee:p,updateEmployee:h,deleteEmployee:g,getEmployeesByStatus:y,fetchEmployeeHourBalance:E,fetchAllEmployeesHourBalances:f}}},3418:(e,r,t)=>{t.d(r,{YX:()=>n,_z:()=>s,mM:()=>o,y6:()=>a});const o=[{value:"active",label:"Actif"},{value:"pending",label:"En attente"},{value:"inactive",label:"Inactif"}],a=[{value:"paid",label:"Cong\xe9s pay\xe9s",color:"#4CAF50",defaultQuota:25},{value:"rtt",label:"RTT",color:"#2196F3",defaultQuota:11},{value:"unpaid",label:"Cong\xe9s sans solde",color:"#9E9E9E",defaultQuota:null},{value:"sick",label:"Maladie",color:"#F44336",defaultQuota:null},{value:"exceptional",label:"Absence exceptionnelle",color:"#FF9800",defaultQuota:null},{value:"recovery",label:"R\xe9cup\xe9ration",color:"#9C27B0",defaultQuota:null}],n=[{date:"2024-01-01",name:"Jour de l'an"},{date:"2024-04-01",name:"Lundi de P\xe2ques"},{date:"2024-05-01",name:"F\xeate du Travail"},{date:"2024-05-08",name:"Victoire 1945"},{date:"2024-05-09",name:"Ascension"},{date:"2024-05-20",name:"Lundi de Pentec\xf4te"},{date:"2024-07-14",name:"F\xeate Nationale"},{date:"2024-08-15",name:"Assomption"},{date:"2024-11-01",name:"Toussaint"},{date:"2024-11-11",name:"Armistice 1918"},{date:"2024-12-25",name:"No\xebl"}],s=[{id:"name",header:"Nom",accessor:e=>`${e.first_name} ${e.last_name}`,sortable:!0},{id:"email",header:"Email",accessor:e=>e.email,sortable:!0},{id:"department",header:"D\xe9partement",accessor:e=>e.department,sortable:!0},{id:"role",header:"R\xf4le",accessor:e=>e.role,sortable:!0},{id:"status",header:"Statut",accessor:e=>e.status,sortable:!0,type:"status"},{id:"hour_balance",header:"Solde d'heures",accessor:e=>{const r=e.hour_balance||0,t=r>=0;return{value:r,display:`${t?"+":""}${r}h`,isPositive:t}},sortable:!0,type:"hour_balance"},{id:"hire_date",header:"Date d'embauche",accessor:e=>{if(!e.hire_date)return"";return new Date(e.hire_date).toLocaleDateString("fr-FR")},sortable:!0,type:"date"}]},4634:(e,r,t)=>{t.d(r,{A:()=>s});var o=t(5043),a=t(3768),n=t(4227);const s=()=>{const e=(0,o.useCallback)((async e=>{try{const t={};e.headers.forEach(((e,r)=>{t[r]=e})),console.log("R\xe9ponse du serveur:",{url:e.url,status:e.status,statusText:e.statusText,headers:t});const o=e.headers.get("content-type");let n;if(o&&o.includes("application/json"))n=await e.json(),console.log("Donn\xe9es JSON re\xe7ues:",n);else{const t=await e.text();console.warn("R\xe9ponse non-JSON re\xe7ue:",t);try{n=JSON.parse(t),console.log("Texte pars\xe9 comme JSON:",n)}catch(r){n={message:t}}}if(e.ok)return n;{401!==e.status&&403!==e.status||(console.error("Erreur d'authentification:",n),a.oR.error("Session expir\xe9e ou acc\xe8s non autoris\xe9. Veuillez vous reconnecter."),localStorage.removeItem("token"),localStorage.removeItem("user"),setTimeout((()=>{window.location.href="/login"}),2e3)),500===e.status&&(console.error("Erreur serveur:",n),console.error("URL:",e.url),console.error("M\xe9thode:",e.method),n.error&&console.error("D\xe9tails de l'erreur:",n.error),n.stack&&console.error("Stack trace:",n.stack));const r=n.message||n.error||e.statusText||"Erreur inconnue",t=new Error(r);throw t.status=e.status,t.response={status:e.status,data:n},t}}catch(t){throw console.error("Erreur lors du traitement de la r\xe9ponse:",t),t}}),[]);return(0,o.useMemo)((()=>{const r=e=>e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));return{get:async r=>{try{console.log(`[API] GET ${r}`);const o=localStorage.getItem("token");if(!o)return console.error("Token d'authentification manquant pour la requ\xeate GET"),a.oR.error("Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 ces donn\xe9es"),setTimeout((()=>{window.location.href="/login"}),2e3),{ok:!1,status:401,data:[]};const s=new AbortController,l=setTimeout((()=>s.abort()),5e3);try{const t=await fetch(`${n.H$}${r}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${o}`},credentials:"include",signal:s.signal});return clearTimeout(l),await e(t)}catch(t){if("AbortError"===t.name)throw console.warn(`La requ\xeate ${r} a \xe9t\xe9 interrompue (timeout)`),new Error("Timeout de la requ\xeate apr\xe8s 5 secondes");throw t}}catch(o){throw console.error(`[API] GET ${r} Error:`,o),401===o.status||403===o.status?(a.oR.error("Session expir\xe9e. Veuillez vous reconnecter."),setTimeout((()=>{window.location.href="/login"}),2e3)):o.message.includes("Timeout")||o.message.includes("fetch")||a.oR.error(o.message||"Erreur lors de la r\xe9cup\xe9ration des donn\xe9es"),o}},post:async(t,o)=>{try{if(!o||"object"!==typeof o)throw console.error("Donn\xe9es invalides pour la requ\xeate POST:",o),new Error("Donn\xe9es invalides pour la requ\xeate POST");const a={};for(const e in o)a[r(e)]=o[e];const s=localStorage.getItem("token");if(!s)throw console.error("Token d'authentification manquant"),new Error("Vous devez \xeatre connect\xe9 pour effectuer cette action");const l={"Content-Type":"application/json",Authorization:`Bearer ${s}`};console.log("D\xe9tails de la requ\xeate POST:",{endpoint:t,dataSize:JSON.stringify(a).length,headers:{...l,Authorization:"Bearer [MASQU\xc9]"}});const c=new AbortController,u=setTimeout((()=>c.abort()),3e4),i=await fetch(`${n.H$}${t}`,{method:"POST",headers:l,body:JSON.stringify(a),signal:c.signal});return clearTimeout(u),e(i)}catch(a){if("AbortError"===a.name)throw console.error("La requ\xeate a \xe9t\xe9 interrompue (timeout):",a),new Error("La requ\xeate a pris trop de temps, veuillez r\xe9essayer");if(a.message.includes("NetworkError")||a.message.includes("Failed to fetch"))throw console.error("Erreur r\xe9seau lors de la requ\xeate POST:",a),new Error("Probl\xe8me de connexion au serveur, veuillez v\xe9rifier votre connexion internet");throw console.error("Erreur lors de la requ\xeate POST:",a),a}},put:async(t,o)=>{try{console.log(`[API] PUT ${t}`,o);const a=localStorage.getItem("token"),s=JSON.parse(JSON.stringify(o)),l={};for(const e in s)l[r(e)]=s[e];const c=await fetch(`${n.H$}${t}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:a?`Bearer ${a}`:""},body:JSON.stringify(l)}),u=await e(c);return console.log(`[API] PUT ${t} Response:`,u),u}catch(a){return console.error(`[API] PUT ${t} Error:`,a),{ok:!1,status:0,data:{message:a.message||"Erreur lors de la requ\xeate PUT"},headers:new Headers}}},delete:async r=>{try{console.log(`[API] DELETE ${r}`);const t=localStorage.getItem("token"),o=await fetch(`${n.H$}${r}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:t?`Bearer ${t}`:""},credentials:"include"}),a=await e(o);return console.log(`[API] DELETE ${r} Response:`,a),a}catch(t){return console.error(`[API] DELETE ${r} Error:`,t),{ok:!1,status:0,data:{message:t.message||"Erreur lors de la requ\xeate DELETE"},headers:new Headers}}}}}),[e])}}}]);
//# sourceMappingURL=205.f522d9af.chunk.js.map