"use strict";(self.webpackChunksmartplanning_ai=self.webpackChunksmartplanning_ai||[]).push([[479],{2479:(e,o,r)=>{r.d(o,{A:()=>a});var t=r(5043),s=r(4227),n=r(4634);const a=()=>{const[e,o]=(0,t.useState)([]),[r,a]=(0,t.useState)(!0),[c,l]=(0,t.useState)(null),i=(0,n.A)(),u=(0,t.useCallback)((async()=>{a(!0);try{const e=s.H$||"http://localhost:5004";console.log(`[fetchEmployees] Utilisation de l'URL: ${e}`);const r=localStorage.getItem("token");if(!r)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const t=await fetch(`${e}/api/employees`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors du chargement des employ\xe9s")}const n=await t.json();return o(Array.isArray(n)?n:[]),l(null),n}catch(c){throw console.error("Erreur lors du chargement des employ\xe9s:",c),l(c.message),c}finally{a(!1)}}),[]),p=(0,t.useCallback)((async e=>{a(!0);try{const o=s.H$||"http://localhost:5004";console.log(`[fetchEmployeeById] Utilisation de l'URL: ${o}`);const r=localStorage.getItem("token");if(!r)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const t=await fetch(`${o}/api/employees/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`}});if(!t.ok){const e=await t.json();throw new Error(e.message||"Erreur lors du chargement de l'employ\xe9")}return await t.json()}catch(c){return console.error(`Erreur lors de la r\xe9cup\xe9ration de l'employ\xe9 ${e}:`,c),l(c.message),null}finally{a(!1)}}),[]),d=(0,t.useCallback)((async e=>{a(!0);try{const{hourlyRate:r,...t}=e,n=s.H$||"http://localhost:5004";console.log(`[createEmployee] Utilisation de l'URL: ${n}`);const a=localStorage.getItem("token");if(!a)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t)),i={};for(const e in c)"zipCode"===e?i.zip_code=c[e]:i[e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))]=c[e];const u=await fetch(`${n}/api/employees`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(i)});if(!u.ok){const e=await u.json();throw new Error(e.message||"Erreur lors de la cr\xe9ation de l'employ\xe9")}const p=await u.json();return o((e=>[...e,p.employee||p])),l(null),{success:!0,employee:p.employee||p,message:"Employ\xe9 cr\xe9\xe9 avec succ\xe8s"}}catch(c){return console.error("Erreur lors de la cr\xe9ation de l'employ\xe9:",c),l(c.message),{success:!1,error:c.message||"Erreur lors de la cr\xe9ation de l'employ\xe9"}}finally{a(!1)}}),[]),h=(0,t.useCallback)((async(e,r)=>{a(!0);try{const{hourlyRate:t,...n}=r,a=s.H$||"http://localhost:5004";console.log(`[updateEmployee] Utilisation de l'URL: ${a}`);const c=localStorage.getItem("token");if(!c)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const l=JSON.parse(JSON.stringify(n)),i={};for(const e in l)"zipCode"===e?i.zip_code=l[e]:i[e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`))]=l[e];const u=await fetch(`${a}/api/employees/${e}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${c}`},body:JSON.stringify(i)});if(!u.ok){const e=await u.json();throw new Error(e.message||"Erreur lors de la mise \xe0 jour de l'employ\xe9")}const p=await u.json();return o((o=>o.map((o=>o.id===e?{...o,...p.employee||p}:o)))),{success:!0,message:"Employ\xe9 mis \xe0 jour avec succ\xe8s",data:p.employee||p}}catch(c){return console.error("Erreur lors de la mise \xe0 jour de l'employ\xe9:",c),l(c.message),{success:!1,error:c.message||"Erreur lors de la mise \xe0 jour de l'employ\xe9"}}finally{a(!1)}}),[]),m=(0,t.useCallback)((async e=>{a(!0);try{const r=s.H$||"http://localhost:5004";console.log(`[deleteEmployee] Utilisation de l'URL: ${r}`);const t=localStorage.getItem("token");if(!t)throw new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const n=await fetch(`${r}/api/employees/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(!n.ok){const e=await n.json();throw new Error(e.message||"Erreur lors de la suppression de l'employ\xe9")}return o((o=>o.filter((o=>o.id!==e)))),{success:!0,message:"Employ\xe9 supprim\xe9 avec succ\xe8s"}}catch(c){return console.error(`Erreur lors de la suppression de l'employ\xe9 ${e}:`,c),l(c.message),{success:!1,error:c.message||"Erreur lors de la suppression de l'employ\xe9"}}finally{a(!1)}}),[]),y=(0,t.useCallback)((o=>o&&"all"!==o?e.filter((e=>e.status===o)):e),[e]),g=(0,t.useCallback)((async e=>{try{const r=Math.floor(200*Math.random());await new Promise((e=>setTimeout(e,r)));const t=await i.get(`/api/hour-balance/${e}`);if(!t||void 0===t.hour_balance&&void 0===t.balance)return console.warn(`Avertissement: Format de r\xe9ponse inattendu pour l'employ\xe9 #${e}`),0;{const r=void 0!==t.hour_balance?t.hour_balance:t.balance;return o((o=>o.map((o=>o.id===e?{...o,hour_balance:r}:o)))),r}}catch(r){return console.warn(`Avertissement: Impossible de r\xe9cup\xe9rer le solde d'heures pour l'employ\xe9 #${e}`),0}}),[i,o]),E=(0,t.useCallback)((async()=>{if(!window._isFetchingHourBalances)try{window._isFetchingHourBalances=!0;for(const o of e)try{await g(o.id),await new Promise((e=>setTimeout(e,300)))}catch(c){console.warn(`Erreur pour l'employ\xe9 ${o.id}, continuons avec le suivant`)}}catch(o){console.error("Erreur lors de la r\xe9cup\xe9ration des soldes d'heures:",o)}finally{window._isFetchingHourBalances=!1}}),[e,g]);(0,t.useEffect)((()=>{let e=!0,r=0;const t=async()=>{if(r>=3)e&&(l("Erreur lors du chargement des employ\xe9s apr\xe8s plusieurs tentatives"),a(!1));else try{if(!localStorage.getItem("token"))return console.error("Token d'authentification manquant"),l("Vous devez \xeatre connect\xe9 pour acc\xe9der \xe0 ces donn\xe9es"),void a(!1);const r=await i.get(s.Sn.EMPLOYEES.BASE);e&&(Array.isArray(r)?(o(r),l(null)):(console.error("Format de donn\xe9es invalide:",r),l("Format de donn\xe9es invalide")),a(!1))}catch(n){e&&(console.error("Erreur lors du chargement des employ\xe9s:",n),l(n.message||"Erreur lors du chargement des employ\xe9s"),r++,setTimeout(t,1e3*Math.pow(2,r)))}};return t(),()=>{e=!1}}),[i]);const w=(0,t.useRef)(!1);return(0,t.useEffect)((()=>{if(e.length>0&&!w.current){w.current=!0;const e=setTimeout((()=>{E()}),1e3);return()=>clearTimeout(e)}}),[e.length,E]),{employees:e,loading:r,error:c,fetchEmployees:u,fetchEmployeeById:p,createEmployee:d,updateEmployee:h,deleteEmployee:m,getEmployeesByStatus:y,fetchEmployeeHourBalance:g,fetchAllEmployeesHourBalances:E}}},4634:(e,o,r)=>{r.d(o,{A:()=>a});var t=r(5043),s=r(3768),n=r(4227);const a=()=>{const e=(0,t.useCallback)((async e=>{try{const r={};e.headers.forEach(((e,o)=>{r[o]=e})),console.log("R\xe9ponse du serveur:",{url:e.url,status:e.status,statusText:e.statusText,headers:r});const t=e.headers.get("content-type");let n;if(t&&t.includes("application/json"))n=await e.json(),console.log("Donn\xe9es JSON re\xe7ues:",n);else{const r=await e.text();console.warn("R\xe9ponse non-JSON re\xe7ue:",r);try{n=JSON.parse(r),console.log("Texte pars\xe9 comme JSON:",n)}catch(o){n={message:r}}}if(e.ok)return n;{if(401===e.status||403===e.status){console.error("Erreur d'authentification:",n),s.oR.error("Session expir\xe9e ou acc\xe8s non autoris\xe9. Veuillez vous reconnecter.");const o=new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");throw o.status=e.status,o.response={status:e.status,data:n},o}500===e.status&&(console.error("Erreur serveur:",n),console.error("URL:",e.url),console.error("M\xe9thode:",e.method),n.error&&console.error("D\xe9tails de l'erreur:",n.error),n.stack&&console.error("Stack trace:",n.stack));const o=n.message||n.error||e.statusText||"Erreur inconnue",r=new Error(o);throw r.status=e.status,r.response={status:e.status,data:n},r}}catch(r){throw console.error("Erreur lors du traitement de la r\xe9ponse:",r),r}}),[]);return(0,t.useMemo)((()=>{const o=e=>{if("zipCode"===e)return console.log(`Conversion sp\xe9ciale: ${e} -> zip_code`),"zip_code";const o=e.replace(/[A-Z]/g,(e=>`_${e.toLowerCase()}`));return console.log(`Conversion camelCase -> snake_case: ${e} -> ${o}`),o};return{get:async o=>{try{const r=n.H$||"http://localhost:5001";console.log(`[API] GET ${r}${o}`);const t=localStorage.getItem("token"),s={"Content-Type":"application/json",...t&&{Authorization:`Bearer ${t}`}},a=await fetch(`${r}${o}`,{method:"GET",headers:s});return e(a)}catch(r){throw console.error(`[API] GET ${o} Error:`,r),r}},post:async(r,t)=>{try{if(!t||"object"!==typeof t)throw console.error("Donn\xe9es invalides pour la requ\xeate POST:",t),new Error("Donn\xe9es invalides pour la requ\xeate POST");const s=n.H$||"http://localhost:5001";console.log(`[API] POST ${s}${r}`);const a=localStorage.getItem("token");if(!a)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t));void 0!==c.hourlyRate&&(console.log("Suppression de hourlyRate des donn\xe9es"),delete c.hourlyRate);const l={};for(const e in c)l[o(e)]=c[e];console.log("Donn\xe9es converties en snake_case pour POST:",l);const i={"Content-Type":"application/json",Authorization:`Bearer ${a}`};console.log("D\xe9tails de la requ\xeate POST:",{endpoint:r,dataSize:JSON.stringify(l).length,headers:{...i,Authorization:"Bearer [MASQU\xc9]"}});const u=new AbortController,p=setTimeout((()=>u.abort()),3e4),d=await fetch(`${s}${r}`,{method:"POST",headers:i,body:JSON.stringify(l),signal:u.signal});if(clearTimeout(p),401===d.status||403===d.status)throw console.error("Erreur d'authentification:",d.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");return e(d)}catch(s){if("AbortError"===s.name)throw console.error("La requ\xeate a \xe9t\xe9 interrompue (timeout):",s),new Error("La requ\xeate a pris trop de temps. Veuillez r\xe9essayer.");if(s.message.includes("NetworkError")||s.message.includes("Failed to fetch"))throw console.error("Erreur r\xe9seau lors de la requ\xeate POST:",s),new Error("Probl\xe8me de connexion au serveur, veuillez v\xe9rifier votre connexion internet");throw console.error("Erreur lors de la requ\xeate POST:",s),s}},put:async(r,t)=>{try{const s=n.H$||"http://localhost:5001";console.log(`[API] PUT ${s}${r}`,t);const a=localStorage.getItem("token");if(!a)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const c=JSON.parse(JSON.stringify(t));console.log("Donn\xe9es nettoy\xe9es:",c),void 0!==c.hourlyRate&&(console.log("Suppression de hourlyRate des donn\xe9es"),delete c.hourlyRate);const l={};for(const e in c)l[o(e)]=c[e];console.log("Donn\xe9es converties en snake_case:",l);const i=await fetch(`${s}${r}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`},body:JSON.stringify(l)});if(401===i.status||403===i.status)throw console.error("Erreur d'authentification:",i.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const u=await e(i);return console.log(`[API] PUT ${r} Response:`,u),u}catch(s){return console.error(`[API] PUT ${r} Error:`,s),{ok:!1,status:s.status||0,data:{message:s.message||"Erreur lors de la requ\xeate PUT"},headers:new Headers}}},delete:async o=>{try{const r=n.H$||"http://localhost:5004";console.log(`[API] DELETE ${r}${o}`);const t=localStorage.getItem("token");if(!t)throw console.error("Token d'authentification manquant"),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const s=await fetch(`${r}${o}`,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}});if(401===s.status||403===s.status)throw console.error("Erreur d'authentification:",s.status),new Error("Veuillez vous connecter pour acc\xe9der \xe0 cette page.");const a=await e(s);return console.log(`[API] DELETE ${o} Response:`,a),a}catch(r){return console.error(`[API] DELETE ${o} Error:`,r),{ok:!1,status:r.status||0,data:{message:r.message||"Erreur lors de la requ\xeate DELETE"},headers:new Headers}}}}}),[e])}}}]);
//# sourceMappingURL=479.038d523c.chunk.js.map